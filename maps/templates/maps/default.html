{% extends 'maps/base.html' %}
{% block content %}
<h1>Home Map</h1>
<div id='map' width="100%" style='height:45em'></div>
<div id="instructions"></div>
<script>
     mapboxgl.accessToken = 'pk.eyJ1IjoiYm1ib2dvIiwiYSI6ImNrbWUzaG9qNjJyazMyd29qMGxrbHZvd2sifQ.oG0-1XdG-OAeNRxL0Vwz6g';

    navigator.geolocation.getCurrentPosition(successLocation, errorLocation, { enableHighAccuracy: true })

    function successLocation(position) {
        setupMap([position.coords.longitude, position.coords.latitude])
    }

    function errorLocation() {
        setupMap([-78.512, 38.036])
    }

    function setupMap(center) {
         var map = new mapboxgl.Map({
           container: 'map',
           center: center,
           zoom: 12,
           style: 'mapbox://styles/mapbox/streets-v11'
         })

         var nav = new mapboxgl.NavigationControl();
         map.addControl(nav);

         var directions = new MapboxDirections({
            accessToken: mapboxgl.accessToken,
         });

         map.addControl(directions, 'top-left');

         map.addSource('UVA', {
             type: 'geojson',
             data: 'https://gist.githubusercontent.com/hudsonburke/7ce0e2657f3c5e22244a10c2cc0e9c6f/raw/7a4e8eefbf0d1b10321e1b13ea254e868ec7ad22/geo_facilities.json' // 'https://jsonkeeper.com/b/0BK4'
         });
         while(!map.isSourceLoaded('UVA')); // makes sure that the source finishes loading before moving on
     }

</script>
{% endblock %}
</body>
</html>
